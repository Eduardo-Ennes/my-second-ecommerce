server {
    listen 80;  
        # Define que o servidor vai escutar na porta 80, que é a porta HTTP padrão.
        # Todo acesso sem HTTPS entrará por aqui.

    server_name localhost;  
        # Define o nome do servidor. 
        # No caso, 'localhost' significa que ele responde apenas a requisições locais.
        # Em produção, normalmente você colocaria seu domínio.

    root /usr/share/nginx/html;  
        # Define o diretório raiz onde os arquivos estáticos estão localizados.
        # Nessa configuração, é onde o React build colocou o 'index.html' e os assets.

    index index.html;            
        # Define qual arquivo será servido quando a URL acessada for um diretório.
        # Ex.: acessar "/" vai servir 'index.html'.

    # GZIP para compressão de arquivos
    gzip on;  
        # Ativa a compressão gzip no Nginx.
        # Gzip reduz o tamanho de arquivos enviados ao navegador, melhorando o tempo de carregamento.

    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
        # Define quais tipos de arquivos serão comprimidos.
        # Evita comprimir arquivos já compactados (como imagens), focando em texto e scripts.

    gzip_min_length 256;  
        # Define tamanho mínimo (em bytes) para ativar gzip.
        # Arquivos menores que isso não são comprimidos, pois a compressão pode ser inútil.

    # Serve arquivos estáticos com cache de longo prazo
    location ~* \.(?:ico|css|js|gif|jpe?g|png|woff2?|eot|ttf|svg|mp4|webm)$ {
            # Regex que casa com arquivos de mídia, fontes, CSS, JS, etc.
        expires 365d;  
            # Diz ao navegador para manter esses arquivos em cache por 365 dias.

        add_header Cache-Control "public";  
            # Marca o cache como "public", permitindo que proxies e CDNs também guardem esses arquivos.
        access_log off;  
            # Desliga o log de acessos desses arquivos, reduzindo o uso de disco para arquivos estáticos.
    }

    # SPA fallback: garante que qualquer rota do React seja servida pelo index.html
    location / {
        try_files $uri /index.html;
            # Primeiro tenta servir o arquivo requisitado ($uri).
            # Se não existir (ex: rotas do React como /dashboard), serve 'index.html'.
            # Essencial para aplicações SPA, pois o React Router cuida das rotas no cliente.
    }

    # Página de erro 50x
    error_page 500 502 503 504 /50x.html;  
        # Define página de erro customizada para erros do servidor.

    location = /50x.html {
        root /usr/share/nginx/html;  
            # Onde está localizado o arquivo 50x.html que será exibido.
    }
}
